RE-read: https://dzone.com/articles/provisioning-an-apache-http-server-with-aws-cloudf

AWSTemplateFormatVersion: 2010-09-09
Resources: 
  BastionVPC:
    Type:  AWS::EC2::VPC
    Properties: 
      CidrBlock: 10.0.0.0/16
      EnableDnsHostnames: 'true'
      EnableDnsSupport: 'true'
      InstanceTenancy: default
  
  BastionSubnet:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.0.0/24
      VpcId: !Ref BastionVPC
      MapPublicIpOnLaunch: true
      AvailabilityZone: us-east-1a
      
  InternetGateway:
    Type: AWS::EC2::InternetGateway
    Properties: {}
    
  EC2VPC:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !Ref BastionVPC
      InternetGatewayId: !Ref InternetGateway
 
  BastionTable: 
    Type: AWS::EC2::RouteTable
    Properties: 
      VpcId: !Ref BastionVPC
    DependsOn: 
      - BastionSubnet

  BastionRoute:
    Type: AWS::EC2::Route
    Properties: 
      RouteTableId: !Ref BastionTable
      GatewayId: !Ref InternetGateway
      DestinationCidrBlock: 0.0.0.0/0
  
   # asscoiate subnet with our route table else by default it is asscoiated with main route table
  BastionSubnetRouteTableAssociation:
    Type: 'AWS::EC2::SubnetRouteTableAssociation'
    Properties:
      SubnetId: !Ref BastionSubnet
      RouteTableId: !Ref BastionTable

  
  
  myPublicNACL:
    Type: 'AWS::EC2::NetworkAcl'
    Properties:
      VpcId: !Ref BastionVPC
      
     
  myNaclRulesForInboundTCP:
    Type: 'AWS::EC2::NetworkAclEntry'
    Properties:
      NetworkAclId: !Ref myPublicNACL
      RuleNumber: '100'
      Protocol: '6'  # tcp
      RuleAction: allow
      Egress: 'false'  # this rule applies to ingress traffic to the subnet
      CidrBlock: 0.0.0.0/0  # any ip address
      PortRange:
        From: '0'
        To: '65535'
        
        
        
        

  myNaclRulesForOutboundTCP:
    Type: 'AWS::EC2::NetworkAclEntry'
    Properties:
      NetworkAclId: !Ref myPublicNACL
      RuleNumber: '100'
      Protocol: '6'  # tcp
      RuleAction: allow
      Egress: 'true'  # this rule applies to egress traffic from the subnet
      CidrBlock: 0.0.0.0/0
      PortRange:
        From: '0'  # client will be using ephemeral port, using 80 or 22 here will not work
        To: '65535'
        

   # associate subnet with NACL else by default it is asscoiated with main NACLs
  BastionSubnetNaclAssociation:
    Type: 'AWS::EC2::SubnetNetworkAclAssociation'
    Properties:
      SubnetId: !Ref BastionSubnet
      NetworkAclId: !Ref myPublicNACL  
      
      
  BastionHost:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: t2.micro
      ImageId: ami-0a887e401f7654935
      NetworkInterfaces: 
        - AssociatePublicIpAddress: "true"
          DeviceIndex: "0"
          SubnetId: 
            Ref: "BastionSubnet"
      UserData: 
        Fn::Base64: |
          #!/bin/bash -xe
          yum update -y # good practice to update existing packages
          yum install -y httpd # install web server 
          systemctl start httpd
          systemctl enable httpd
          echo "Hello World" > /var/www/html/index.html       
    DependsOn:
      - BastionRoute   
      
      
      



---------------------------------------
Above line is working
--------------------------------------- 

-----------------------------------
FINAL 20 HOURS STUDY - MOST MY WORK
-----------------------------------

FROM : https://dzone.com/articles/provisioning-an-apache-http-server-with-aws-cloudf

AWSTemplateFormatVersion: 2010-09-09
Resources: 
  BastionVPC:
    Type:  AWS::EC2::VPC
    Properties: 
      CidrBlock: 10.0.0.0/16
      EnableDnsHostnames: 'true'
      EnableDnsSupport: 'true'
      InstanceTenancy: default
  
  BastionSubnet:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.0.0/24
      VpcId: !Ref BastionVPC
      MapPublicIpOnLaunch: true
      AvailabilityZone: us-east-1a
      
  InternetGateway:
    Type: AWS::EC2::InternetGateway
    Properties: {}
    
  EC2VPC:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !Ref BastionVPC
      InternetGatewayId: !Ref InternetGateway
 
  BastionTable: 
    Type: AWS::EC2::RouteTable
    Properties: 
      VpcId: !Ref BastionVPC
    DependsOn: 
      - BastionSubnet

  BastionRoute:
    Type: AWS::EC2::Route
    Properties: 
      RouteTableId: !Ref BastionTable
      GatewayId: !Ref InternetGateway
      DestinationCidrBlock: 0.0.0.0/0
  
   # asscoiate subnet with our route table else by default it is asscoiated with main route table
  BastionSubnetRouteTableAssociation:
    Type: 'AWS::EC2::SubnetRouteTableAssociation'
    Properties:
      SubnetId: !Ref BastionSubnet
      RouteTableId: !Ref BastionTable

  
  
  myPublicNACL:
    Type: 'AWS::EC2::NetworkAcl'
    Properties:
      VpcId: !Ref BastionVPC
      
     
  myNaclRulesForInboundTCP:
    Type: 'AWS::EC2::NetworkAclEntry'
    Properties:
      NetworkAclId: !Ref myPublicNACL
      RuleNumber: '100'
      Protocol: '6'  # tcp
      RuleAction: allow
      Egress: 'false'  # this rule applies to ingress traffic to the subnet
      CidrBlock: 0.0.0.0/0  # any ip address
      PortRange:
        From: '0'
        To: '65535'
        
        
        
        

  myNaclRulesForOutboundTCP:
    Type: 'AWS::EC2::NetworkAclEntry'
    Properties:
      NetworkAclId: !Ref myPublicNACL
      RuleNumber: '100'
      Protocol: '6'  # tcp
      RuleAction: allow
      Egress: 'true'  # this rule applies to egress traffic from the subnet
      CidrBlock: 0.0.0.0/0
      PortRange:
        From: '0'  # client will be using ephemeral port, using 80 or 22 here will not work
        To: '65535'
        

   # associate subnet with NACL else by default it is asscoiated with main NACLs
  BastionSubnetNaclAssociation:
    Type: 'AWS::EC2::SubnetNetworkAclAssociation'
    Properties:
      SubnetId: !Ref BastionSubnet
      NetworkAclId: !Ref myPublicNACL  
  
      
  
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      















------ISSUES BELOW----------
"BastionHost:
    Type: AWS::EC2::Instance
    Properties:
      KeyName: test <<< cant make key in CF, only reference exiting
      InstanceType: t2.micro
      ImageId: ami-0a887e401f7654935
      NetworkInterfaces: 
      - AssociatePublicIpAddress: True
        DeleteOnTermination: True
        DeviceIndex: 0
      - SubnetId: !Ref BastionSubnet "" << Why I have under Interface

Network interfaces and an instance-level subnet ID
may not be specified on the same request (Service: AmazonEC2;
Status Code: 400; Error Code: InvalidParameterCombination; 
Request ID: 16b54228-8a06-465f-becc-296a7456f6ea)



  BastionGatewayRouteTableAssociation:    
    Type: AWS::EC2::GatewayRouteTableAssociation
    Properties: 
      RouteTableId: !Ref RouteTable
      GatewayId: !Ref InternetGateway 
    
    BastionGatewayRouteTableAssociation	CREATE_FAILED	
    Route table contains unsupported route destination. 
    The unsupported route destination is less specific
    than or non-overlapping with VPC local CIDR. 
    (Service: AmazonEC2; Status Code: 400; 
    Error Code: RouteNotSupported; 
    Request ID: acc00e40-f8d3-456e-ad82-cc06a5508e00)
    
    
    
